<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="Tree based Elemental Mesh">
    <meta name="author" content="University of Siegen" >
    <link rel="icon" href="../favicon.png">

    <title>tem_shape_findElemByBCLabels &ndash; Treelm</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="../css/fontawesome.min.css" rel="stylesheet">
    <link href="../css/brands.min.css" rel="stylesheet">
    <link href="../css/regular.min.css" rel="stylesheet">
    <link href="../css/solid.min.css" rel="stylesheet">
    <link href="../css/v4-font-face.min.css" rel="stylesheet">
    <link href="../css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="../css/local.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">Treelm </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="../page/index.html">TreElm Overview</a></li>
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/absint.html">Abstract Interfaces</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/types.html">Derived Types</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>tem_shape_findElemByBCLabels
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title=" 0.3% of total for procedures.">90 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/tem_shape_module.f90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/tem_shape_module.f90.html'>tem_shape_module.f90</a></li>
                <li class="breadcrumb-item"><a href='../module/tem_shape_module.html'>tem_shape_module</a></li>
            <li class="breadcrumb-item active" aria-current="page">tem_shape_findElemByBCLabels</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    // Enable Bootstrap tooltips
    (function () {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    })();
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/tem_shape_findelembybclabels.html#src">tem_shape_findElemByBCLabels</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>private  subroutine tem_shape_findElemByBCLabels(bcLabels, cutOffQVal, bc_prop, foundAny, map2global, inTree, countPoints, grwPnts, storePnts, bcIDs, stencil)  
</h2>
    

    <p>This routine identifies elements that belong to certain bounaries.
Labels of required boundaries are given by bcLabels.
bc_prop contains boudnary_ID of all local elements.
Firstly, bcLabels are converted into bcIDs.
Then all elements in bc_prop are looped over to check if it matches one of
the required bcID. If match, its position is save in map2global.
Number of elements found on each level is saved in countElems.</p>


    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-bclabels~4"></span>
              character(len=labelLen),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>bcLabels</strong>(:)</td>
            <td>
                <p>bcLabels</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-cutoffqval~2"></span>
              real(kind=rk),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>cutOffQVal</strong></td>
            <td>
                <p>Cut off qValue</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-bc_prop"></span>
              type(<a href='../type/tem_bc_prop_type.html'>tem_BC_prop_type</a>),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>bc_prop</strong></td>
            <td>
                <p>bc property</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-foundany~2"></span>
              logical,
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>foundAny</strong></td>
            <td>
                <p>if any element be identified</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-map2global~2"></span>
              type(<a href='../type/dyn_intarray_type.html'>dyn_intarray_type</a>),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>map2global</strong></td>
            <td>
                <p>dynamic array. Elements positions in bc_prop%property%elemID</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-intree~2"></span>
              type(<a href='../type/treelmesh_type.html'>treelmesh_type</a>),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>inTree</strong></td>
            <td>
                <p>Global tree</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-countpoints~2"></span>
              integer,
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>countPoints</strong></td>
            <td>
                <p>How many points there will be</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-grwpnts~2"></span>
              type(<a href='../type/tem_grwpoints_type.html'>tem_grwPoints_type</a>),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>grwPnts</strong></td>
            <td>
                <p>growing array to store tracking points</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-storepnts~2"></span>
              logical,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>storePnts</strong></td>
            <td>
                <p>to Store points in grwPnts</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-bcids"></span>
              integer,
            </td>
<td>intent(out),</td>
              <td></td>            <td>
              allocatable
            </td>
            <td>::</td>
            <td><strong>bcIDs</strong>(:)</td>
            <td>
                <p>id of boundary condition to be tracked</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-stencil"></span>
              type(<a href='../type/tem_stencilheader_type.html'>tem_stencilHeader_type</a>),
            </td>
<td>intent(in),</td>
              <td>optional</td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>stencil</strong></td>
            <td>
                <p>stencil required to get useful links</p>
            </td>
        </tr>
    </tbody>
  </table>

    <br>


    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">  </span><span class="k">subroutine </span><span class="n">tem_shape_findElemByBCLabels</span><span class="p">(</span><span class="w"> </span><span class="n">bcLabels</span><span class="p">,</span><span class="w"> </span><span class="n">cutOffQVal</span><span class="p">,</span><span class="w"> </span><span class="n">bc_prop</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span>
<span class="w">    </span><span class="p">&amp;</span><span class="w">                                      </span><span class="n">foundAny</span><span class="p">,</span><span class="w"> </span><span class="n">map2global</span><span class="p">,</span><span class="w"> </span><span class="n">inTree</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span>
<span class="w">    </span><span class="p">&amp;</span><span class="w">                                      </span><span class="n">countPoints</span><span class="p">,</span><span class="w"> </span><span class="n">grwPnts</span><span class="p">,</span><span class="w"> </span><span class="n">storePnts</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span>
<span class="w">    </span><span class="p">&amp;</span><span class="w">                                      </span><span class="n">bcIDs</span><span class="p">,</span><span class="w"> </span><span class="n">stencil</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="c">! --------------------------------------------------------------------------</span>
<span class="w">    </span><span class="c">!&gt; bcLabels</span>
<span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">labelLen</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">bcLabels</span><span class="p">(:)</span>
<span class="w">    </span><span class="c">!&gt; Cut off qValue</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">rk</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cutOffQVal</span>
<span class="w">    </span><span class="c">!&gt; bc property</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">tem_bc_prop_type</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">bc_prop</span>
<span class="w">    </span><span class="c">!&gt; if any element be identified</span>
<span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">                 </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">foundAny</span>
<span class="w">    </span><span class="c">!&gt; dynamic array. Elements positions in bc_prop%property%elemID</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">dyn_intArray_type</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">map2global</span>
<span class="w">    </span><span class="c">!&gt; Global tree</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">treelmesh_type</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">inTree</span>
<span class="w">    </span><span class="c">!&gt; How many points there will be</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="w"> </span><span class="n">inout</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">countPoints</span>
<span class="w">    </span><span class="c">!&gt; growing array to store tracking points</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">tem_grwPoints_type</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">grwPnts</span>
<span class="w">    </span><span class="c">!&gt; to Store points in grwPnts</span>
<span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">storePnts</span>
<span class="w">    </span><span class="c">!&gt; id of boundary condition to be tracked</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">bcIDs</span><span class="p">(:)</span>
<span class="w">    </span><span class="c">!&gt; stencil required to get useful links</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="w"> </span><span class="n">tem_stencilHeader_type</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="k">optional</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stencil</span>
<span class="w">    </span><span class="c">! --------------------------------------------------------------------------</span>
<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dPos</span><span class="p">,</span><span class="w"> </span><span class="n">iElem</span><span class="p">,</span><span class="w"> </span><span class="n">iBC</span><span class="p">,</span><span class="w"> </span><span class="n">nBCs</span><span class="p">,</span><span class="w"> </span><span class="n">iBCtype</span><span class="p">,</span><span class="w"> </span><span class="n">posInTree</span><span class="p">,</span><span class="w"> </span><span class="n">QQN</span>
<span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">wasAdded</span><span class="p">,</span><span class="w"> </span><span class="n">found</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">map</span><span class="p">(:)</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">rk</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qValWeight</span><span class="p">(:),</span><span class="w"> </span><span class="n">weightedQVal</span><span class="p">(:)</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">rk</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dx</span><span class="p">,</span><span class="w"> </span><span class="n">bary</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">point</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">minQVal</span>
<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iDir</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">iElem_qVal</span><span class="p">,</span><span class="w"> </span><span class="n">minQValiDir</span>
<span class="w">    </span><span class="c">! --------------------------------------------------------------------------</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="nb">present</span><span class="p">(</span><span class="w"> </span><span class="n">stencil</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">      allocate</span><span class="p">(</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">stencil</span><span class="p">%</span><span class="n">map</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">      </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stencil</span><span class="p">%</span><span class="n">map</span>
<span class="w">      </span><span class="n">qqn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stencil</span><span class="p">%</span><span class="n">QQN</span>
<span class="w">    </span><span class="k">else</span>
<span class="k">      allocate</span><span class="p">(</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="n">qQQQ</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">      </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qDir</span>
<span class="w">      </span><span class="n">qqn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qQQQ</span>
<span class="w">    </span><span class="k">end if</span>

<span class="w">    </span><span class="c">! calculate weights on qValue for each direction. </span>
<span class="w">    </span><span class="c">! It depends on the link length.</span>
<span class="w">    </span><span class="k">allocate</span><span class="p">(</span><span class="n">weightedQVal</span><span class="p">(</span><span class="n">qqn</span><span class="p">))</span>
<span class="w">    </span><span class="k">allocate</span><span class="p">(</span><span class="n">qValWeight</span><span class="p">(</span><span class="n">qqn</span><span class="p">))</span>
<span class="w">    </span><span class="k">do </span><span class="n">iDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">qqn</span>
<span class="w">      </span><span class="n">length</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">qOffset</span><span class="p">(</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="n">iDir</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="n">qOffset</span><span class="p">(</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="n">iDir</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="n">qOffset</span><span class="p">(</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="n">iDir</span><span class="p">),</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="w">      </span><span class="n">qValWeight</span><span class="p">(</span><span class="n">iDir</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="nb">kind</span><span class="o">=</span><span class="n">rk</span><span class="p">))</span>
<span class="w">    </span><span class="k">end do</span>

<span class="k">    </span><span class="n">foundAny</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">    </span><span class="c">! convert bcLabels to bcIDs</span>
<span class="w">    </span><span class="n">nBCs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">bcLabels</span><span class="p">)</span>
<span class="w">    </span><span class="k">allocate</span><span class="p">(</span><span class="w"> </span><span class="n">bcIDs</span><span class="p">(</span><span class="w"> </span><span class="n">nBCs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>

<span class="w">    </span><span class="c">! loop over all required bcLabels</span>
<span class="w">    </span><span class="k">do </span><span class="n">iBC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nBCs</span>

<span class="w">      </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>

<span class="w">      </span><span class="c">! loop over all BCs in the mesh</span>
<span class="w">      </span><span class="k">do </span><span class="n">iBCtype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">bc_prop</span><span class="p">%</span><span class="n">nBCtypes</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">bcLabels</span><span class="p">(</span><span class="n">iBC</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">bc_prop</span><span class="p">%</span><span class="n">bc_label</span><span class="p">(</span><span class="w"> </span><span class="n">iBCtype</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          </span><span class="n">bcIDs</span><span class="p">(</span><span class="w"> </span><span class="n">iBC</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iBCtype</span>
<span class="w">          </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">          </span><span class="k">exit</span>
<span class="k">        end if</span>
<span class="k">      end do</span>

<span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">        write</span><span class="p">(</span><span class="n">logUnit</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Required BC label: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">bcLabels</span><span class="p">(</span><span class="n">iBC</span><span class="p">))</span>
<span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="n">logUnit</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;can not be found in given mesh!&#39;</span>
<span class="w">        </span><span class="k">stop</span>
<span class="k">      end if</span>
<span class="k">    end do</span><span class="w"> </span><span class="c">! iBC</span>

<span class="w">    </span><span class="n">iElem_qVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="c">! Loop over all element with boundary property</span>
<span class="w">    </span><span class="k">do </span><span class="n">iElem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">bc_prop</span><span class="p">%</span><span class="n">property</span><span class="p">%</span><span class="n">nElems</span>
<span class="w">      </span><span class="n">posInTree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bc_prop</span><span class="p">%</span><span class="n">property</span><span class="p">%</span><span class="n">elemID</span><span class="p">(</span><span class="n">iElem</span><span class="p">)</span>
<span class="w">      </span><span class="c">! Count the elem with qVal property to access the qVal from</span>
<span class="w">      </span><span class="c">! bc_prop%qVal</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">btest</span><span class="p">(</span><span class="w"> </span><span class="n">inTree</span><span class="p">%</span><span class="n">elemPropertyBits</span><span class="p">(</span><span class="w"> </span><span class="n">posInTree</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">prp_hasQVal</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">        </span><span class="n">iElem_qVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iElem_qVal</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="k">end if</span>

<span class="k">      do </span><span class="n">iBC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nBCs</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">any</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bc_prop</span><span class="p">%</span><span class="n">boundary_ID</span><span class="p">(</span><span class="w"> </span><span class="n">map</span><span class="p">(:</span><span class="n">qqn</span><span class="p">),</span><span class="w"> </span><span class="n">iElem</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">bcIDs</span><span class="p">(</span><span class="n">iBC</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>

<span class="w">          </span><span class="c">! If element has qValues then consider element which satisfy</span>
<span class="w">          </span><span class="c">! cutOffQVal</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">btest</span><span class="p">(</span><span class="n">inTree</span><span class="p">%</span><span class="n">ElemPropertyBits</span><span class="p">(</span><span class="n">posInTree</span><span class="p">),</span><span class="w"> </span><span class="n">prp_hasQVal</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">            do </span><span class="n">iDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">qqn</span>
<span class="w">              </span><span class="n">weightedQVal</span><span class="p">(</span><span class="n">iDir</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qValWeight</span><span class="p">(</span><span class="n">iDir</span><span class="p">)</span><span class="w">                  </span><span class="p">&amp;</span>
<span class="w">                </span><span class="p">&amp;</span><span class="w">                </span><span class="o">*</span><span class="w"> </span><span class="n">bc_prop</span><span class="p">%</span><span class="n">qVal</span><span class="p">(</span><span class="n">map</span><span class="p">(</span><span class="n">iDir</span><span class="p">),</span><span class="w"> </span><span class="n">iElem_qVal</span><span class="p">)</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">            </span><span class="n">minQValiDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">minloc</span><span class="p">(</span><span class="n">weightedQVal</span><span class="p">,</span><span class="w"> </span><span class="nb">DIM</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">MASK</span><span class="o">=</span><span class="p">(</span><span class="n">weightedQVal</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">))</span>
<span class="w">            </span><span class="n">minQVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bc_prop</span><span class="p">%</span><span class="n">qVal</span><span class="p">(</span><span class="n">map</span><span class="p">(</span><span class="n">minQValiDir</span><span class="p">),</span><span class="w"> </span><span class="n">iElem_qVal</span><span class="p">)</span>
<span class="w">          </span><span class="k">else</span>
<span class="k">            </span><span class="n">minQVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cutOffQVal</span>
<span class="w">          </span><span class="k">end if</span>

<span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="n">minQVal</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">cutOffQVal</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>

<span class="w">            </span><span class="c">! Append to treeID list (note that already existing ones are</span>
<span class="w">            </span><span class="c">! omitted)</span>
<span class="w">            </span><span class="k">call </span><span class="n">append</span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">map2global</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">          </span><span class="n">pos</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">dPos</span><span class="p">,</span><span class="w">         </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">          </span><span class="n">val</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">posInTree</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">          </span><span class="n">wasAdded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasAdded</span><span class="w"> </span><span class="p">)</span>

<span class="w">            </span><span class="c">! Count up if it was added</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">wasAdded</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">              </span><span class="c">! tLevel = tem_levelOf( inTree%treeID(posInTree) )</span>
<span class="w">              </span><span class="c">! countElems( tLevel ) = countElems( tLevel ) + 1</span>
<span class="w">              </span><span class="n">foundAny</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>

<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">storePnts</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="c">! Create growing array of points for boundary elements with </span>
<span class="w">                </span><span class="c">! qValues.</span>
<span class="w">                </span><span class="c">! Point is created along minimum qValue direction.</span>
<span class="w">                </span><span class="n">bary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tem_BaryOfId</span><span class="p">(</span><span class="w"> </span><span class="n">inTree</span><span class="p">,</span><span class="w"> </span><span class="n">inTree</span><span class="p">%</span><span class="n">treeID</span><span class="p">(</span><span class="n">posInTree</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">btest</span><span class="p">(</span><span class="n">inTree</span><span class="p">%</span><span class="n">ElemPropertyBits</span><span class="p">(</span><span class="n">posInTree</span><span class="p">),</span><span class="w"> </span><span class="n">prp_hasQVal</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tem_ElemSize</span><span class="p">(</span><span class="w"> </span><span class="n">inTree</span><span class="p">,</span><span class="w"> </span><span class="n">inTree</span><span class="p">%</span><span class="n">treeID</span><span class="p">(</span><span class="n">posInTree</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>
<span class="w">                  </span><span class="n">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bary</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">qOffset</span><span class="p">(</span><span class="n">map</span><span class="p">(</span><span class="n">minQValiDir</span><span class="p">),</span><span class="w"> </span><span class="p">:)</span>
<span class="w">                  </span><span class="c">! append the physical points to the growing array of points</span>
<span class="w">                  </span><span class="k">call </span><span class="n">append</span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">grwPnts</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="p">&amp;</span><span class="w">          </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">point</span><span class="w">    </span><span class="p">)</span>
<span class="w">                </span><span class="k">else</span>
<span class="k">                  call </span><span class="n">append</span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">grwPnts</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="p">&amp;</span><span class="w">          </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bary</span><span class="w">     </span><span class="p">)</span>
<span class="w">                </span><span class="k">end if</span>
<span class="k">                </span><span class="n">countPoints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">countPoints</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">            end if</span><span class="w"> </span><span class="c">!storePnts</span>

<span class="w">            </span><span class="k">exit</span><span class="w"> </span><span class="c">! continue with next element</span>
<span class="w">          </span><span class="k">end if</span><span class="w"> </span><span class="c">! wasAdded</span>

<span class="w">        </span><span class="k">end if</span><span class="w"> </span><span class="c">! boundary_ID == bcIDs</span>
<span class="w">      </span><span class="k">end do</span>

<span class="k">    end do</span><span class="w"> </span><span class="c">! iElem</span>

<span class="w">  </span><span class="k">end subroutine </span><span class="n">tem_shape_findElemByBCLabels</span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              Treelm
 was developed by University of Siegen<br>              &copy; 2025 
<br /><small>9899d1376992</small></p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2025-07-02T13:06:23.655310+0000             </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>