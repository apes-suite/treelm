<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="Tree based Elemental Mesh">
    <meta name="author" content="University of Siegen" >
    <link rel="icon" href="../favicon.png">

    <title>request_remoteHalos &ndash; Treelm</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="../css/fontawesome.min.css" rel="stylesheet">
    <link href="../css/brands.min.css" rel="stylesheet">
    <link href="../css/regular.min.css" rel="stylesheet">
    <link href="../css/solid.min.css" rel="stylesheet">
    <link href="../css/v4-font-face.min.css" rel="stylesheet">
    <link href="../css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="../css/local.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">Treelm </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="../page/index.html">TreElm Overview</a></li>
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/absint.html">Abstract Interfaces</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/types.html">Derived Types</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>request_remoteHalos
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title=" 0.3% of total for procedures.">104 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/tem_construction_module.f90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/tem_construction_module.f90.html'>tem_construction_module.f90</a></li>
                <li class="breadcrumb-item"><a href='../module/tem_construction_module.html'>tem_construction_module</a></li>
            <li class="breadcrumb-item active" aria-current="page">request_remoteHalos</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    // Enable Bootstrap tooltips
    (function () {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    })();
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/request_remotehalos.html#src">request_remoteHalos</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>private  subroutine request_remoteHalos(levelDesc, proc, tree, iLevel, stencil, pathFirst, pathLast)  
</h2>
    

    <p>Inverse Communication: Communicate, which elements each process needs from
me.</p>
<p>In this routine, we send the treeIDs of the halo elements to the
processes, where they are located. Later on, we fill these halos locally
with information from these processes (sourceProcs). In this routine
however, we now SEND information to these sourceProcs, so do not get
confused here.</p>


    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-leveldesc~41"></span>
              type(<a href='../type/tem_leveldesc_type.html'>tem_levelDesc_type</a>),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>levelDesc</strong>(tree%global%minlevel:)</td>
            <td>
                <p>the level descriptor to be filled</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-proc~22"></span>
              type(<a href='../type/tem_comm_env_type.html'>tem_comm_env_type</a>),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>proc</strong></td>
            <td>
                <p>Process description to use.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-tree~145"></span>
              type(<a href='../type/treelmesh_type.html'>treelmesh_type</a>),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>tree</strong></td>
            <td>
                <p>the global tree</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ilevel~64"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>iLevel</strong></td>
            <td>
                <p>current level</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-stencil~21"></span>
              type(<a href='../type/tem_stencilheader_type.html'>tem_stencilHeader_type</a>),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>stencil</strong></td>
            <td>
                <p>stencil definition</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-pathfirst~8"></span>
              type(<a href='../type/tem_path_type.html'>tem_path_type</a>),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>pathFirst</strong>(:)</td>
            <td>
                <p>first and last treeID path in every process</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-pathlast~8"></span>
              type(<a href='../type/tem_path_type.html'>tem_path_type</a>),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>pathLast</strong>(:)</td>
            <td>
                <p>first and last treeID path in every process</p>
            </td>
        </tr>
    </tbody>
  </table>

    <br>


    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">  </span><span class="k">subroutine </span><span class="n">request_remoteHalos</span><span class="p">(</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">,</span><span class="w"> </span><span class="n">proc</span><span class="p">,</span><span class="w"> </span><span class="n">tree</span><span class="p">,</span><span class="w"> </span><span class="n">iLevel</span><span class="p">,</span><span class="w"> </span><span class="n">stencil</span><span class="p">,&amp;</span>
<span class="w">    </span><span class="p">&amp;</span><span class="w">                             </span><span class="n">pathFirst</span><span class="p">,</span><span class="w"> </span><span class="n">pathLast</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="c">! ---------------------------------------------------------------------------</span>
<span class="w">    </span><span class="c">!&gt; the global tree</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">treelmesh_type</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tree</span>
<span class="w">    </span><span class="c">!&gt; the level descriptor to be filled</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">tem_levelDesc_type</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="n">tree</span><span class="p">%</span><span class="n">global</span><span class="p">%</span><span class="n">minlevel</span><span class="p">:</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="c">!&gt; Process description to use.</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">tem_comm_env_type</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">proc</span>
<span class="w">    </span><span class="c">!&gt; current level</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iLevel</span>
<span class="w">    </span><span class="c">!&gt; stencil definition</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">tem_stencilHeader_type</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stencil</span>
<span class="w">    </span><span class="c">!&gt; first and last treeID path in every process</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">tem_path_type</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">pathFirst</span><span class="p">(:),</span><span class="w"> </span><span class="n">pathLast</span><span class="p">(:)</span>
<span class="w">    </span><span class="c">! ---------------------------------------------------------------------------</span>
<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iProc</span><span class="p">,</span><span class="w"> </span><span class="n">iErr</span><span class="p">,</span><span class="w"> </span><span class="n">iElem</span><span class="p">,</span><span class="w"> </span><span class="n">elemPos</span><span class="p">,</span><span class="w"> </span><span class="n">procPos</span>
<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">haloLevel</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rq_handle</span><span class="p">(:)</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">status</span><span class="p">(:,:</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nCommunications</span><span class="p">,</span><span class="w"> </span><span class="n">nesting</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="w"> </span><span class="n">grw_longArray_type</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">treeIDs_fromTarget</span><span class="p">(:)</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="w"> </span><span class="n">grw_intArray_type</span><span class="w"> </span><span class="p">),</span><span class="w">  </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nestings_fromTarget</span><span class="p">(:)</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="w"> </span><span class="n">grw_longArray_type</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">treeIDs_toSource</span><span class="p">(:)</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="w"> </span><span class="n">grw_intArray_type</span><span class="w"> </span><span class="p">),</span><span class="w">  </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nestings_toSource</span><span class="p">(:)</span>
<span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">updated</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">message_flag_long</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">24</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">message_flag_int</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span>
<span class="w">    </span><span class="c">! ---------------------------------------------------------------------------</span>

<span class="w">    </span><span class="k">call </span><span class="n">tem_horizontalSpacer</span><span class="p">(</span><span class="w"> </span><span class="n">fUnit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbgUnit</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="k">write</span><span class="p">(</span><span class="n">dbgUnit</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot;Get into routine: request_remoteHalos&quot;</span>
<span class="w">    </span><span class="k">write</span><span class="p">(</span><span class="n">dbgUnit</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Requesting remote halos on level: &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">iLevel</span>

<span class="w">    </span><span class="c">! two communications: treeID and nesting</span>
<span class="w">    </span><span class="n">nCommunications</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="w">  </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbuffer</span><span class="p">%</span><span class="n">nProcs</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">      </span><span class="p">&amp;</span><span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">recvbuffer</span><span class="p">%</span><span class="n">nProcs</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="k">allocate</span><span class="p">(</span><span class="w"> </span><span class="n">rq_handle</span><span class="p">(</span><span class="w"> </span><span class="n">nCommunications</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="k">allocate</span><span class="p">(</span><span class="w"> </span><span class="n">status</span><span class="p">(</span><span class="w"> </span><span class="n">mpi_status_size</span><span class="p">,</span><span class="w"> </span><span class="n">nCommunications</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">rq_handle</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI_REQUEST_NULL</span>

<span class="w">    </span><span class="c">! Warning: Inverse Communication ! (send to source, recv from target)</span>
<span class="w">    </span><span class="c">! ---------------------------------------------------------------------</span>
<span class="w">    </span><span class="c">! I receive from target what elements are needed by them</span>
<span class="w">    </span><span class="c">! SendBuffer contains my elements required by remote targets</span>
<span class="w">    </span><span class="k">allocate</span><span class="p">(</span><span class="w">  </span><span class="n">treeIDs_fromTarget</span><span class="p">(</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbuffer</span><span class="p">%</span><span class="n">nProcs</span><span class="w"> </span><span class="p">))</span>
<span class="w">    </span><span class="k">allocate</span><span class="p">(</span><span class="w"> </span><span class="n">nestings_fromTarget</span><span class="p">(</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbuffer</span><span class="p">%</span><span class="n">nProcs</span><span class="w"> </span><span class="p">))</span>

<span class="w">    </span><span class="k">do </span><span class="n">iProc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbuffer</span><span class="p">%</span><span class="n">nProcs</span>

<span class="w">      </span><span class="c">! Allocate the buffers</span>
<span class="w">      </span><span class="k">call </span><span class="n">init</span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">treeIDs_fromTarget</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">),</span><span class="w">                      </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbuffer</span><span class="p">%</span><span class="n">nElemsProc</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">))</span>
<span class="w">      </span><span class="k">call </span><span class="n">init</span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">nestings_fromTarget</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">),</span><span class="w">                     </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbuffer</span><span class="p">%</span><span class="n">nElemsProc</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">))</span>

<span class="w">      </span><span class="c">! Receive the element tree IDs</span>
<span class="w">      </span><span class="k">call </span><span class="n">mpi_irecv</span><span class="p">(</span><span class="w"> </span><span class="n">treeIDs_fromTarget</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)%</span><span class="n">val</span><span class="p">,</span><span class="w">                         </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">             </span><span class="n">treeIDs_fromTarget</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)%</span><span class="n">ContainerSize</span><span class="p">,</span><span class="w">               </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">             </span><span class="n">mpi_integer8</span><span class="p">,</span><span class="w">                                            </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">             </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbuffer</span><span class="p">%</span><span class="n">proc</span><span class="p">(</span><span class="n">iProc</span><span class="p">),</span><span class="w">              </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">             </span><span class="n">message_flag_long</span><span class="p">,</span><span class="w">                                       </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">             </span><span class="n">proc</span><span class="p">%</span><span class="n">comm</span><span class="p">,</span><span class="w">                                               </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">             </span><span class="n">rq_handle</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="p">),</span><span class="w">                                       </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">             </span><span class="n">iErr</span><span class="w"> </span><span class="p">)</span>
<span class="w">      </span><span class="c">! Receive the element nestings</span>
<span class="w">      </span><span class="k">call </span><span class="n">mpi_irecv</span><span class="p">(</span><span class="w"> </span><span class="n">nestings_fromTarget</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)%</span><span class="n">val</span><span class="p">,</span><span class="w">                        </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">             </span><span class="n">nestings_fromTarget</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)%</span><span class="n">ContainerSize</span><span class="p">,</span><span class="w">              </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">             </span><span class="n">mpi_integer</span><span class="p">,</span><span class="w">                                             </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">             </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbuffer</span><span class="p">%</span><span class="n">proc</span><span class="p">(</span><span class="n">iProc</span><span class="p">),</span><span class="w">              </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">             </span><span class="n">message_flag_int</span><span class="p">,</span><span class="w">                                        </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">             </span><span class="n">proc</span><span class="p">%</span><span class="n">comm</span><span class="p">,</span><span class="w">                                               </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">             </span><span class="n">rq_handle</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="o">+</span><span class="n">nCommunications</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="p">),</span><span class="w">                    </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">             </span><span class="n">iErr</span><span class="w">  </span><span class="p">)</span>
<span class="w">      </span><span class="c">! Update the number of elements inside the growing array of the recv</span>
<span class="w">      </span><span class="c">! buffer</span>
<span class="w">       </span><span class="n">treeIDs_fromTarget</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)%</span><span class="n">nVals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">treeIDs_fromTarget</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)%</span><span class="n">ContainerSize</span>
<span class="w">      </span><span class="n">nestings_fromTarget</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)%</span><span class="n">nVals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">treeIDs_fromTarget</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)%</span><span class="n">ContainerSize</span>
<span class="w">    </span><span class="k">end do</span><span class="w"> </span><span class="c">! iProc</span>
<span class="w">    </span><span class="c">! ---------------------------------------------------------------------</span>

<span class="w">    </span><span class="c">! ---------------------------------------------------------------------</span>
<span class="w">    </span><span class="c">! I send to source what elements I need from them</span>
<span class="w">    </span><span class="k">allocate</span><span class="p">(</span><span class="w">  </span><span class="n">treeIDs_toSource</span><span class="p">(</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">recvbuffer</span><span class="p">%</span><span class="n">nProcs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="k">allocate</span><span class="p">(</span><span class="w"> </span><span class="n">nestings_toSource</span><span class="p">(</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">recvbuffer</span><span class="p">%</span><span class="n">nProcs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>

<span class="w">    </span><span class="k">do </span><span class="n">iProc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">recvbuffer</span><span class="p">%</span><span class="n">nProcs</span>

<span class="w">      </span><span class="c">! Get the position of the process in the dynamic halos list (might be</span>
<span class="w">      </span><span class="c">! unordered)</span>
<span class="w">      </span><span class="n">procPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PositionOfVal</span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="n">iLevel</span><span class="p">)%</span><span class="n">haloList</span><span class="p">%</span><span class="n">PartnerProc</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">                      </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="n">iLevel</span><span class="p">)%</span><span class="n">recvbuffer</span><span class="w">            </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">                                             </span><span class="p">%</span><span class="n">proc</span><span class="p">(</span><span class="n">iProc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">       </span><span class="p">)</span>

<span class="w">      </span><span class="k">call </span><span class="n">init</span><span class="p">(</span><span class="w">  </span><span class="n">me</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">treeIDs_toSource</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">),</span><span class="w">                        </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">         </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">recvbuffer</span><span class="p">%</span><span class="n">nElemsProc</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">))</span>
<span class="w">      </span><span class="k">call </span><span class="n">init</span><span class="p">(</span><span class="w">  </span><span class="n">me</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">nestings_toSource</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">),</span><span class="w">                       </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">         </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">recvbuffer</span><span class="p">%</span><span class="n">nElemsProc</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">))</span>

<span class="w">      </span><span class="c">! Collect the halo treeIDs into send buffers for all the processes to</span>
<span class="w">      </span><span class="c">! request from</span>
<span class="w">      </span><span class="k">do </span><span class="n">iElem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">recvbuffer</span><span class="p">%</span><span class="n">nElemsProc</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="n">elemPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">haloList</span><span class="p">%</span><span class="n">halos</span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="n">procPos</span><span class="p">)%</span><span class="n">val</span><span class="p">(</span><span class="n">iElem</span><span class="p">)</span>
<span class="w">        </span><span class="k">call </span><span class="n">append</span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">treeIDs_toSource</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">),</span><span class="w">                  </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w">          </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">elem</span><span class="p">%</span><span class="n">tID</span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="w"> </span><span class="n">elemPos</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="k">call </span><span class="n">append</span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">nestings_toSource</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">),</span><span class="w">                         </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w">          </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">elem</span><span class="p">%</span><span class="n">haloNesting</span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="w"> </span><span class="n">elemPos</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">      </span><span class="k">enddo</span>

<span class="w">      </span><span class="c">! Send treeIDs</span>
<span class="w">      </span><span class="k">call </span><span class="n">mpi_isend</span><span class="p">(</span><span class="w">                                                           </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">treeIDs_toSource</span><span class="p">(</span><span class="n">iProc</span><span class="p">)%</span><span class="n">val</span><span class="p">,</span><span class="w">                                   </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">treeIDs_toSource</span><span class="p">(</span><span class="n">iProc</span><span class="p">)%</span><span class="n">nVals</span><span class="p">,</span><span class="w">                                 </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">mpi_integer8</span><span class="p">,</span><span class="w">                                                  </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">recvbuffer</span><span class="p">%</span><span class="n">proc</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">),</span><span class="w">                  </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">message_flag_long</span><span class="p">,</span><span class="w">                                             </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">proc</span><span class="p">%</span><span class="n">comm</span><span class="p">,</span><span class="w">                                                     </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">rq_handle</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbuffer</span><span class="p">%</span><span class="n">nProcs</span><span class="p">),</span><span class="w">     </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">ierr</span><span class="w">  </span><span class="p">)</span>
<span class="w">      </span><span class="c">! Send nesting</span>
<span class="w">      </span><span class="k">call </span><span class="n">mpi_isend</span><span class="p">(</span><span class="w">                                                           </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">nestings_toSource</span><span class="p">(</span><span class="n">iProc</span><span class="p">)%</span><span class="n">val</span><span class="p">,</span><span class="w">                                  </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">nestings_toSource</span><span class="p">(</span><span class="n">iProc</span><span class="p">)%</span><span class="n">nVals</span><span class="p">,</span><span class="w">                                </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">mpi_integer</span><span class="p">,</span><span class="w">                                                   </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">recvbuffer</span><span class="p">%</span><span class="n">proc</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">),</span><span class="w">                  </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">message_flag_int</span><span class="p">,</span><span class="w">                                              </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">proc</span><span class="p">%</span><span class="n">comm</span><span class="p">,</span><span class="w">                                                     </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">rq_handle</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbuffer</span><span class="p">%</span><span class="n">nProcs</span><span class="w">       </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">                         </span><span class="o">+</span><span class="w"> </span><span class="n">nCommunications</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="w">                         </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">        </span><span class="n">ierr</span><span class="w">  </span><span class="p">)</span>

<span class="w">    </span><span class="k">end do</span><span class="w"> </span><span class="c">! iProc</span>

<span class="w">    </span><span class="k">call </span><span class="n">mpi_waitall</span><span class="p">(</span><span class="w"> </span><span class="n">nCommunications</span><span class="p">,</span><span class="w"> </span><span class="n">rq_handle</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="p">)</span>
<span class="w">    </span><span class="k">write</span><span class="p">(</span><span class="n">logUnit</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;  Received requested halo elements successfully.&#39;</span>
<span class="w">    </span><span class="k">deallocate</span><span class="p">(</span><span class="w">  </span><span class="n">treeIDs_toSource</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="k">deallocate</span><span class="p">(</span><span class="w"> </span><span class="n">nestings_toSource</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="k">deallocate</span><span class="p">(</span><span class="w">         </span><span class="n">rq_handle</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="k">deallocate</span><span class="p">(</span><span class="w">         </span><span class="n">status</span><span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="c">! Requested halo elements were received.</span>
<span class="w">    </span><span class="c">! ---------------------------------------------------------------------------</span>

<span class="w">    </span><span class="c">! ---------------------------------------------------------------------------</span>
<span class="w">    </span><span class="c">! Now identify the requested halos.</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="nb">allocated</span><span class="p">(</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbufferFromCoarser</span><span class="p">%</span><span class="n">elemPos</span><span class="p">))</span><span class="w">         </span><span class="p">&amp;</span>
<span class="w">      </span><span class="p">&amp;</span><span class="w">         </span><span class="k">deallocate</span><span class="p">(</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbufferFromCoarser</span><span class="p">%</span><span class="n">elemPos</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="k">allocate</span><span class="p">(</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbufferFromCoarser</span><span class="p">%</span><span class="n">elemPos</span><span class="p">(</span><span class="w">               </span><span class="p">&amp;</span>
<span class="w">      </span><span class="p">&amp;</span><span class="w">                                </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbuffer</span><span class="p">%</span><span class="n">nProcs</span><span class="w"> </span><span class="p">))</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="nb">allocated</span><span class="p">(</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbufferFromFiner</span><span class="p">%</span><span class="n">elemPos</span><span class="w"> </span><span class="p">))</span><span class="w">          </span><span class="p">&amp;</span>
<span class="w">      </span><span class="p">&amp;</span><span class="w">           </span><span class="k">deallocate</span><span class="p">(</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbufferFromFiner</span><span class="p">%</span><span class="n">elemPos</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="k">allocate</span><span class="p">(</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbufferFromFiner</span><span class="p">%</span><span class="n">elemPos</span><span class="p">(</span><span class="w">                 </span><span class="p">&amp;</span>
<span class="w">      </span><span class="p">&amp;</span><span class="w">                                </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbuffer</span><span class="p">%</span><span class="n">nProcs</span><span class="w"> </span><span class="p">))</span>

<span class="w">    </span><span class="c">! Add elements of received buffers to elem</span>
<span class="w">    </span><span class="k">do </span><span class="n">iProc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbuffer</span><span class="p">%</span><span class="n">nProcs</span>
<span class="w">      </span><span class="c">! Allocate the buffer for the element position indices</span>
<span class="w">      </span><span class="k">call </span><span class="n">init</span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbuffer</span><span class="p">%</span><span class="n">elemPos</span><span class="p">(</span><span class="n">iProc</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">      </span><span class="k">call </span><span class="n">init</span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbufferFromCoarser</span><span class="p">%</span><span class="n">elemPos</span><span class="p">(</span><span class="n">iProc</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">      </span><span class="k">call </span><span class="n">init</span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbufferFromFiner</span><span class="p">%</span><span class="n">elemPos</span><span class="p">(</span><span class="n">iProc</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>

<span class="w">      </span><span class="k">do </span><span class="n">iElem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">treeIDs_fromTarget</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)%</span><span class="n">nVals</span>
<span class="w">        </span><span class="n">nesting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nestings_fromTarget</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)%</span><span class="n">val</span><span class="p">(</span><span class="w"> </span><span class="n">iElem</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="c">! identify requested halo treeID in local process</span>
<span class="w">        </span><span class="k">call </span><span class="n">identify_halo</span><span class="p">(</span><span class="w"> </span><span class="n">haloTreeID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">treeIDs_fromTarget</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)%</span><span class="n">val</span><span class="p">(</span><span class="n">iElem</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">elemPos</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">elemPos</span><span class="p">,</span><span class="w">                          </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">halolevel</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">haloLevel</span><span class="p">,</span><span class="w">                        </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">levelDesc</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">,</span><span class="w">                        </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">nesting</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">nesting</span><span class="p">,</span><span class="w">                          </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">updated</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">updated</span><span class="p">,</span><span class="w">                          </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">tree</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">,</span><span class="w">                             </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">minLevel</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">%</span><span class="n">global</span><span class="p">%</span><span class="n">minLevel</span><span class="p">,</span><span class="w">             </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">stencil</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">stencil</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">elemPos</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">          </span><span class="c">! if requested halo is ghostFromCoarser then find stencil neighbors of</span>
<span class="w">          </span><span class="c">! this halo element</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">nesting</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nestingLimit</span><span class="p">)</span><span class="w">                           </span><span class="p">&amp;</span>
<span class="w">            </span><span class="p">&amp;</span><span class="w">  </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">elem</span><span class="p">%</span><span class="n">eType</span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="n">elemPos</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">            </span><span class="p">&amp;</span><span class="w">         </span><span class="o">==</span><span class="w"> </span><span class="n">eT_ghostFromCoarser</span><span class="p">)</span><span class="w">                     </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="c">! identify all the compute neighbors of the current element</span>
<span class="w">            </span><span class="k">call </span><span class="n">identify_stencilNeigh</span><span class="p">(</span><span class="w"> </span><span class="n">iElem</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">elemPos</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">iLevel</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">iLevel</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">tree</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">iStencil</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">pathFirst</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">pathFirst</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">pathLast</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">pathLast</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">levelDesc</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">proc</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="n">proc</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">stencil</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">stencil</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">nesting</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">nesting</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">          </span><span class="k">end if</span>

<span class="w">          </span><span class="c">! if requested halo element haloNesting &lt; found halo element (elemPos)</span>
<span class="w">          </span><span class="c">! haloNesting</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nestings_fromTarget</span><span class="p">(</span><span class="n">iProc</span><span class="p">)%</span><span class="n">val</span><span class="p">(</span><span class="n">iElem</span><span class="p">)</span><span class="w">                  </span><span class="p">&amp;</span>
<span class="w">            </span><span class="p">&amp;</span><span class="w">  </span><span class="o">&lt;</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">haloLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">elem</span><span class="p">%</span><span class="n">haloNesting</span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="n">elemPos</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">levelDesc</span><span class="p">(</span><span class="n">haloLevel</span><span class="p">)%</span><span class="n">elem</span><span class="p">%</span><span class="n">needsUpdate</span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="n">elemPos</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">            </span><span class="n">levelDesc</span><span class="p">(</span><span class="n">haloLevel</span><span class="p">)</span><span class="w">                                             </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">  </span><span class="p">%</span><span class="n">elem</span><span class="w">                                                       </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">  </span><span class="p">%</span><span class="n">haloNesting</span><span class="w">                                                </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">  </span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="n">elemPos</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">nestings_fromTarget</span><span class="p">(</span><span class="n">iProc</span><span class="p">)%</span><span class="n">val</span><span class="p">(</span><span class="n">iElem</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">                       </span><span class="n">levelDesc</span><span class="p">(</span><span class="n">haloLevel</span><span class="p">)</span><span class="w">                   </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">                         </span><span class="p">%</span><span class="n">elem</span><span class="w">                                </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">                         </span><span class="p">%</span><span class="n">haloNesting</span><span class="w">                         </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">                         </span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="n">elemPos</span><span class="p">)</span><span class="w">                        </span><span class="p">)</span>
<span class="w">          </span><span class="k">end if</span>

<span class="w">          </span><span class="c">! only add, if the element was added locally</span>
<span class="w">          </span><span class="k">select case</span><span class="p">(</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="n">iLevel</span><span class="p">)%</span><span class="n">elem</span><span class="p">%</span><span class="n">eType</span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="n">elemPos</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">          </span><span class="c">! Depending on the type of the element, add to the</span>
<span class="w">          </span><span class="c">! regular buffer, bufferFromCoarser, bufferFromFiner</span>
<span class="w">          </span><span class="k">case</span><span class="p">(</span><span class="w"> </span><span class="n">eT_fluid</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="k">call </span><span class="n">append</span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbuffer</span><span class="p">%</span><span class="n">elemPos</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">),&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">          </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">elemPos</span><span class="w"> </span><span class="p">)</span>
<span class="w">          </span><span class="k">case</span><span class="p">(</span><span class="w"> </span><span class="n">eT_ghostFromCoarser</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="k">call </span><span class="n">append</span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbufferFromCoarser</span><span class="w">       </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">                                             </span><span class="p">%</span><span class="n">elemPos</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">          </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">elemPos</span><span class="w"> </span><span class="p">)</span>

<span class="w">            </span><span class="c">! for ghostFromCoarser determine neighbors of coarser element</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">haloLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">elem</span><span class="p">%</span><span class="n">haloNesting</span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="w"> </span><span class="n">elemPos</span><span class="w"> </span><span class="p">)</span><span class="w">         </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">                                        </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nestingLimit</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              call </span><span class="n">create_allParentNeighbors</span><span class="p">(</span><span class="w">                                  </span><span class="p">&amp;</span>
<span class="w">                </span><span class="p">&amp;</span><span class="w">      </span><span class="n">targetID</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="n">iLevel</span><span class="p">)%</span><span class="n">elem</span><span class="p">%</span><span class="n">tID</span><span class="p">%</span><span class="n">val</span><span class="p">(</span><span class="w"> </span><span class="n">elemPos</span><span class="w"> </span><span class="p">),&amp;</span>
<span class="w">                </span><span class="p">&amp;</span><span class="w">      </span><span class="n">level</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">iLevel</span><span class="p">,</span><span class="w">                                </span><span class="p">&amp;</span>
<span class="w">                </span><span class="p">&amp;</span><span class="w">      </span><span class="n">tree</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">,</span><span class="w">                                  </span><span class="p">&amp;</span>
<span class="w">                </span><span class="p">&amp;</span><span class="w">      </span><span class="n">stencil</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">stencil</span><span class="p">,</span><span class="w">                        </span><span class="p">&amp;</span>
<span class="w">                </span><span class="p">&amp;</span><span class="w">      </span><span class="n">levelDesc</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">,</span><span class="w">                             </span><span class="p">&amp;</span>
<span class="w">                </span><span class="p">&amp;</span><span class="w">      </span><span class="n">pathFirst</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">pathFirst</span><span class="p">,</span><span class="w">                             </span><span class="p">&amp;</span>
<span class="w">                </span><span class="p">&amp;</span><span class="w">      </span><span class="n">pathLast</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">pathLast</span><span class="p">,</span><span class="w">                              </span><span class="p">&amp;</span>
<span class="w">                </span><span class="p">&amp;</span><span class="w">      </span><span class="n">proc</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="k">end if</span>

<span class="k">          case</span><span class="p">(</span><span class="w"> </span><span class="n">eT_ghostFromFiner</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="k">call </span><span class="n">append</span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbufferFromFiner</span><span class="w">         </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">                </span><span class="p">%</span><span class="n">elemPos</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">),</span><span class="w">                              </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">          </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">elemPos</span><span class="w"> </span><span class="p">)</span>
<span class="w">          </span><span class="k">case</span><span class="p">(</span><span class="w"> </span><span class="n">eT_distributedGhostFromFiner</span><span class="p">)</span>
<span class="w">             </span><span class="k">write</span><span class="p">(</span><span class="n">logUnit</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39; Found distributed ghost From Finer in &#39;</span><span class="o">//</span><span class="w">    </span><span class="p">&amp;</span>
<span class="w">               </span><span class="p">&amp;</span><span class="w">                </span><span class="s1">&#39;request remote Halos&#39;</span>
<span class="w">             </span><span class="k">write</span><span class="p">(</span><span class="n">logUnit</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39; This case should not occur!&#39;</span>
<span class="w">             </span><span class="k">call </span><span class="n">tem_abort</span><span class="p">()</span>
<span class="w">          </span><span class="k">end select</span>
<span class="k">        end if</span><span class="w"> </span><span class="c">! elemPos &gt; 0</span>
<span class="w">      </span><span class="k">end do</span><span class="w"> </span><span class="c">! ielem recvbuffer</span>

<span class="w">      </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbuffer</span><span class="p">%</span><span class="n">nElemsProc</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)</span><span class="w">                       </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbuffer</span><span class="p">%</span><span class="n">elemPos</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)%</span><span class="n">nVals</span>
<span class="w">      </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbufferFromCoarser</span><span class="p">%</span><span class="n">nElemsProc</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)</span><span class="w">            </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbufferFromCoarser</span><span class="p">%</span><span class="n">elemPos</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)%</span><span class="n">nVals</span>
<span class="w">      </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbufferFromFiner</span><span class="p">%</span><span class="n">nElemsProc</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)</span><span class="w">              </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">levelDesc</span><span class="p">(</span><span class="w"> </span><span class="n">iLevel</span><span class="w"> </span><span class="p">)%</span><span class="n">sendbufferFromFiner</span><span class="p">%</span><span class="n">elemPos</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)%</span><span class="n">nVals</span>

<span class="w">      </span><span class="c">! destroy temp variables</span>
<span class="w">      </span><span class="k">call </span><span class="n">destroy</span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">treeIDs_fromTarget</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">      </span><span class="k">call </span><span class="n">destroy</span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nestings_fromTarget</span><span class="p">(</span><span class="w"> </span><span class="n">iProc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="k">end do</span><span class="w"> </span><span class="c">! iProc</span>
<span class="w">    </span><span class="k">deallocate</span><span class="p">(</span><span class="w">  </span><span class="n">treeIDs_fromTarget</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="k">deallocate</span><span class="p">(</span><span class="w"> </span><span class="n">nestings_fromTarget</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="c">! Now each Process knows, which elements to send to others</span>
<span class="w">    </span><span class="c">! ---------------------------------------------------------------------</span>
<span class="w">    </span><span class="k">write</span><span class="p">(</span><span class="n">logUnit</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Finished requesting remote halos&#39;</span>

<span class="w">    </span><span class="k">write</span><span class="p">(</span><span class="n">dbgUnit</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot;Leave  routine: request_remoteHalos&quot;</span>
<span class="w">    </span><span class="k">call </span><span class="n">tem_horizontalSpacer</span><span class="p">(</span><span class="w"> </span><span class="n">fUnit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbgUnit</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>

<span class="w">  </span><span class="k">end subroutine </span><span class="n">request_remoteHalos</span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              Treelm
 was developed by University of Siegen<br>              &copy; 2025 
<br /><small>9899d1376992</small></p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2025-07-02T13:06:23.655310+0000             </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>