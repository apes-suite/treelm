<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="Tree based Elemental Mesh">
    <meta name="author" content="University of Siegen" >
    <link rel="icon" href="../favicon.png">

    <title>tem_cano_checkNeigh &ndash; Treelm</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="../css/fontawesome.min.css" rel="stylesheet">
    <link href="../css/brands.min.css" rel="stylesheet">
    <link href="../css/regular.min.css" rel="stylesheet">
    <link href="../css/solid.min.css" rel="stylesheet">
    <link href="../css/v4-font-face.min.css" rel="stylesheet">
    <link href="../css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="../css/local.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">Treelm </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="../page/index.html">TreElm Overview</a></li>
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/absint.html">Abstract Interfaces</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/types.html">Derived Types</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>tem_cano_checkNeigh
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title=" 0.2% of total for procedures.">63 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/tem_canonical_module.f90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/tem_canonical_module.f90.html'>tem_canonical_module.f90</a></li>
                <li class="breadcrumb-item"><a href='../module/tem_canonicalnd_module.html'>tem_canonicalND_module</a></li>
            <li class="breadcrumb-item active" aria-current="page">tem_cano_checkNeigh</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    // Enable Bootstrap tooltips
    (function () {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    })();
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/tem_cano_checkneigh.html#src">tem_cano_checkNeigh</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>public  subroutine tem_cano_checkNeigh(me, inTree, countElems, map2global)  
</h2>
    

    <p>Check for neighboring elements to a given point.</p>
<p>This routine can be used to find close by elements for points that just
lie outside the domain and for which values can be extrapolated, though
they do not strictly reside in the computational domain described by
inTree.
The closest neighboring element is identified globally and added to the
map2global if any is found.
This only works for points, and none of the points in the given list
should have been found inside the domain.</p>


    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-me~364"></span>
              type(<a href='../type/tem_canonicalnd_type.html'>tem_canonicalND_type</a>),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>me</strong>(:)</td>
            <td>
                <p>canonicalND objects to check, only points will be considered</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-intree~9"></span>
              type(<a href='../type/treelmesh_type.html'>treelmesh_type</a>),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>inTree</strong></td>
            <td>
                <p>Global tree</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-countelems~5"></span>
              integer,
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>countElems</strong>(globalMaxLevels)</td>
            <td>
                <p>How many elements there will be for each level in the track</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-map2global~8"></span>
              type(<a href='../type/dyn_intarray_type.html'>dyn_intarray_type</a>),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>map2global</strong></td>
            <td>
                <p>growing array for the map2global</p>
            </td>
        </tr>
    </tbody>
  </table>

    <br>


    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">  </span><span class="k">subroutine </span><span class="n">tem_cano_checkNeigh</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="w"> </span><span class="n">inTree</span><span class="p">,</span><span class="w"> </span><span class="n">countElems</span><span class="p">,</span><span class="w"> </span><span class="n">map2global</span><span class="p">)</span>
<span class="w">    </span><span class="c">! --------------------------------------------------------------------------</span>
<span class="w">    </span><span class="c">!&gt; canonicalND objects to check, only points will be considered</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">tem_canonicalND_type</span><span class="w"> </span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">me</span><span class="p">(:)</span>
<span class="w">    </span><span class="c">!&gt; Global tree</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">treelmesh_type</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">inTree</span>
<span class="w">    </span><span class="c">!&gt; How many elements there will be for each level in the track</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="w"> </span><span class="n">inout</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">countElems</span><span class="p">(</span><span class="w"> </span><span class="n">globalMaxLevels</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="c">!&gt; growing array for the map2global</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">dyn_intArray_type</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">map2global</span>
<span class="w">    </span><span class="c">! --------------------------------------------------------------------------</span>
<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iCano</span><span class="p">,</span><span class="w"> </span><span class="n">tLevel</span><span class="p">,</span><span class="w"> </span><span class="n">elemPos</span><span class="p">,</span><span class="w"> </span><span class="n">dPos</span><span class="p">,</span><span class="w"> </span><span class="n">maxLevel</span><span class="p">,</span><span class="w"> </span><span class="n">iQQN</span>
<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">closest_neigh</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">me</span><span class="p">))</span>
<span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">wasAdded</span>
<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">coordOfId</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nCanoNDs</span>
<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iError</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">long_k</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">treeID</span><span class="p">,</span><span class="w"> </span><span class="n">tOffset</span><span class="p">,</span><span class="w"> </span><span class="n">neighID</span>
<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">minproc</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">me</span><span class="p">))</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">rk</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mindist</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">me</span><span class="p">)),</span><span class="w"> </span><span class="n">dist</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">rk</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">minglobdist</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">me</span><span class="p">))</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">rk</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">elemcenter</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="c">! --------------------------------------------------------------------------</span>
<span class="w">    </span><span class="n">maxLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inTree</span><span class="p">%</span><span class="n">global</span><span class="p">%</span><span class="n">maxLevel</span>
<span class="w">    </span><span class="n">mindist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">huge</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
<span class="w">    </span><span class="n">closest_neigh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">nCanoNDs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">me</span><span class="p">)</span>

<span class="w">    </span><span class="c">! Create subTree by intersecting canoND objects with the inTree</span>
<span class="w">    </span><span class="k">do </span><span class="n">iCano</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nCanoNDs</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">me</span><span class="p">(</span><span class="n">iCano</span><span class="p">)%</span><span class="nb">kind</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;point&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">        </span><span class="n">treeID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tem_IdOfCoord</span><span class="p">(</span><span class="w"> </span><span class="n">tem_CoordOfReal</span><span class="p">(</span><span class="n">inTree</span><span class="p">,</span><span class="w">                     </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w">                                     </span><span class="n">me</span><span class="p">(</span><span class="n">iCano</span><span class="p">)%</span><span class="n">point</span><span class="p">%</span><span class="n">coord</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w">                                     </span><span class="n">maxLevel</span><span class="p">)</span><span class="w">                   </span><span class="p">)</span>
<span class="w">        </span><span class="c">! add a neighbor element of this point if any of the neighbor exist to</span>
<span class="w">        </span><span class="c">! interpolate to a point</span>
<span class="w">        </span><span class="n">coordOfId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tem_CoordOfId</span><span class="p">(</span><span class="w"> </span><span class="n">treeID</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="n">tOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tem_FirstIdAtLevel</span><span class="p">(</span><span class="w"> </span><span class="n">coordOfId</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="n">directionLoop</span><span class="p">:</span><span class="w"> </span><span class="k">do </span><span class="n">iQQN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">qQQQ</span>
<span class="w">          </span><span class="n">neighID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tem_IdOfCoord</span><span class="p">(</span><span class="w">                          </span><span class="p">&amp;</span>
<span class="w">            </span><span class="p">&amp;</span><span class="w">         </span><span class="p">[</span><span class="w"> </span><span class="n">coordOfId</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">qOffset</span><span class="p">(</span><span class="w"> </span><span class="n">iQQN</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span>
<span class="w">            </span><span class="p">&amp;</span><span class="w">           </span><span class="n">coordOfId</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">qOffset</span><span class="p">(</span><span class="w"> </span><span class="n">iQQN</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span>
<span class="w">            </span><span class="p">&amp;</span><span class="w">           </span><span class="n">coordOfId</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">qOffset</span><span class="p">(</span><span class="w"> </span><span class="n">iQQN</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span>
<span class="w">            </span><span class="p">&amp;</span><span class="w">           </span><span class="n">coordOfId</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="n">tOffset</span><span class="p">)</span>
<span class="w">          </span><span class="n">elemPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tem_PosOfId</span><span class="p">(</span><span class="n">neighID</span><span class="p">,</span><span class="w"> </span><span class="n">inTree</span><span class="p">%</span><span class="n">treeID</span><span class="p">)</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">elemPos</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">elemcenter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tem_BaryOfId</span><span class="p">(</span><span class="n">inTree</span><span class="p">,</span><span class="w"> </span><span class="n">neighID</span><span class="p">)</span>
<span class="w">            </span><span class="n">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="w">  </span><span class="p">(</span><span class="n">me</span><span class="p">(</span><span class="n">iCano</span><span class="p">)%</span><span class="n">point</span><span class="p">%</span><span class="n">coord</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">elemcenter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">         </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">(</span><span class="n">iCano</span><span class="p">)%</span><span class="n">point</span><span class="p">%</span><span class="n">coord</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">elemcenter</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">              </span><span class="p">&amp;</span><span class="w">         </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">(</span><span class="n">iCano</span><span class="p">)%</span><span class="n">point</span><span class="p">%</span><span class="n">coord</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">elemcenter</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dist</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">mindist</span><span class="p">(</span><span class="n">iCano</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">mindist</span><span class="p">(</span><span class="n">iCano</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dist</span>
<span class="w">              </span><span class="n">closest_neigh</span><span class="p">(</span><span class="n">iCano</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">elemPos</span>
<span class="w">            </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">dist</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">mindist</span><span class="p">(</span><span class="n">iCano</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="w">              </span><span class="c">! Make sure to pick the first element in the SFC ordering</span>
<span class="w">              </span><span class="c">! as the nearest neighbor, if there are multiple with the</span>
<span class="w">              </span><span class="c">! same distance (&lt;= comparison to avoid == comparison for</span>
<span class="w">              </span><span class="c">! reals)</span>
<span class="w">              </span><span class="n">closest_neigh</span><span class="p">(</span><span class="n">iCano</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="n">elemPos</span><span class="p">,</span><span class="w"> </span><span class="n">closest_neigh</span><span class="p">(</span><span class="n">iCano</span><span class="p">))</span>
<span class="w">            </span><span class="k">end if</span>
<span class="k">          end if</span>
<span class="k">        end do </span><span class="n">directionLoop</span>
<span class="w">      </span><span class="k">end if</span>
<span class="k">    end do</span>

<span class="k">    call </span><span class="n">MPI_Allreduce</span><span class="p">(</span><span class="w"> </span><span class="n">mindist</span><span class="p">,</span><span class="w"> </span><span class="n">minglobdist</span><span class="p">,</span><span class="w"> </span><span class="n">nCanoNDs</span><span class="p">,</span><span class="w">             </span><span class="p">&amp;</span>
<span class="w">      </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">rk_mpi</span><span class="p">,</span><span class="w"> </span><span class="n">MPI_MIN</span><span class="p">,</span><span class="w"> </span><span class="n">inTree</span><span class="p">%</span><span class="n">global</span><span class="p">%</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">iError</span><span class="w"> </span><span class="p">)</span>

<span class="w">    </span><span class="n">minproc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inTree</span><span class="p">%</span><span class="n">global</span><span class="p">%</span><span class="n">nParts</span>
<span class="w">    </span><span class="k">do </span><span class="n">iCano</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nCanoNDs</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">minglobdist</span><span class="p">(</span><span class="n">iCano</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">huge</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mindist</span><span class="p">(</span><span class="n">iCano</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">minglobdist</span><span class="p">(</span><span class="n">iCano</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          </span><span class="n">minproc</span><span class="p">(</span><span class="n">iCano</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inTree</span><span class="p">%</span><span class="n">global</span><span class="p">%</span><span class="n">myPart</span>
<span class="w">        </span><span class="k">end if</span>
<span class="k">      end if</span>
<span class="k">    end do</span>

<span class="k">    call </span><span class="n">MPI_Allreduce</span><span class="p">(</span><span class="w"> </span><span class="n">MPI_IN_PLACE</span><span class="p">,</span><span class="w"> </span><span class="n">minproc</span><span class="p">,</span><span class="w"> </span><span class="n">nCanoNDs</span><span class="p">,</span><span class="w">                 </span><span class="p">&amp;</span>
<span class="w">      </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">MPI_INTEGER</span><span class="p">,</span><span class="w"> </span><span class="n">MPI_MIN</span><span class="p">,</span><span class="w"> </span><span class="n">inTree</span><span class="p">%</span><span class="n">global</span><span class="p">%</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">iError</span><span class="w"> </span><span class="p">)</span>

<span class="w">    </span><span class="k">do </span><span class="n">iCano</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nCanoNDs</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">me</span><span class="p">(</span><span class="n">iCano</span><span class="p">)%</span><span class="nb">kind</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;point&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">        </span><span class="n">found_elem</span><span class="p">:</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">minproc</span><span class="p">(</span><span class="n">iCano</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">inTree</span><span class="p">%</span><span class="n">global</span><span class="p">%</span><span class="n">myPart</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">          </span><span class="c">! append the position in inTree to the map (note that already existing</span>
<span class="w">          </span><span class="c">! ones are omitted)</span>
<span class="w">          </span><span class="k">call </span><span class="n">append</span><span class="p">(</span><span class="w"> </span><span class="n">me</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">map2global</span><span class="p">,</span><span class="w">           </span><span class="p">&amp;</span>
<span class="w">            </span><span class="p">&amp;</span><span class="w">          </span><span class="n">pos</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">dpos</span><span class="p">,</span><span class="w">                 </span><span class="p">&amp;</span>
<span class="w">            </span><span class="p">&amp;</span><span class="w">          </span><span class="n">val</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">closest_neigh</span><span class="p">(</span><span class="n">iCano</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">            </span><span class="p">&amp;</span><span class="w">          </span><span class="n">wasAdded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasAdded</span><span class="w">              </span><span class="p">)</span>

<span class="w">          </span><span class="c">! Count up if it was added</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">wasAdded</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">tLevel</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">tem_levelOf</span><span class="p">(</span><span class="w"> </span><span class="n">inTree</span><span class="p">%</span><span class="n">treeID</span><span class="p">(</span><span class="n">closest_neigh</span><span class="p">(</span><span class="n">iCano</span><span class="p">))</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="n">countElems</span><span class="p">(</span><span class="w"> </span><span class="n">tLevel</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">countElems</span><span class="p">(</span><span class="w"> </span><span class="n">tLevel</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">          </span><span class="k">end if</span><span class="w"> </span><span class="c">! wasAdded</span>
<span class="w">        </span><span class="k">end if </span><span class="n">found_elem</span>
<span class="w">      </span><span class="k">end if</span>
<span class="k">    end do</span>

<span class="k">  end subroutine </span><span class="n">tem_cano_checkNeigh</span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              Treelm
 was developed by University of Siegen<br>              &copy; 2025 
<br /><small>9899d1376992</small></p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2025-07-02T13:06:23.655310+0000             </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>